databaseChangeLog:
  - changeSet:
      id: 001-create-categories
      author: system
      changes:
        - createTable:
            tableName: categories
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: slug
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: sort_order
                  type: INT
                  defaultValueNumeric: 0
                  constraints:
                    nullable: false
              - column:
                  name: active
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: false
              - column:
                  name: parent_id
                  type: UUID
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
        - addForeignKeyConstraint:
            baseTableName: categories
            baseColumnNames: parent_id
            constraintName: fk_categories_parent
            referencedTableName: categories
            referencedColumnNames: id
            onDelete: SET NULL


  - changeSet:
      id: 002-update-products
      author: system
      changes:
        - addColumn:
            tableName: products
            columns:
              - column:
                  name: sku
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: active
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: false
              - column:
                  name: category_id
                  type: UUID
              - column:
                  name: product_type
                  type: VARCHAR(50)
                  defaultValue: "STANDARD"
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
        - addForeignKeyConstraint:
            baseTableName: products
            baseColumnNames: category_id
            constraintName: fk_products_category
            referencedTableName: categories
            referencedColumnNames: id
            onDelete: SET NULL

  - changeSet:
      id: 003-create-tags
      author: system
      changes:
        - createTable:
            tableName: tags
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: slug
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: tag_category_id
                  type: UUID
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP

  - changeSet:
      id: 004-create-tag-categories
      author: system
      changes:
        - createTable:
            tableName: tag_categories
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: description
                  type: TEXT
              - column:
                  name: slug
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
        - addForeignKeyConstraint:
            baseTableName: tags
            baseColumnNames: tag_category_id
            constraintName: fk_tags_category
            referencedTableName: tag_categories
            referencedColumnNames: id
            onDelete: SET NULL

  - changeSet:
      id: 005-create-product-tags
      author: system
      changes:
        - createTable:
            tableName: product_tags
            columns:
              - column:
                  name: product_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: tag_id
                  type: UUID
                  constraints:
                    nullable: false
        - addPrimaryKey:
            tableName: product_tags
            columnNames: product_id, tag_id
            constraintName: pk_product_tags
        - addForeignKeyConstraint:
            baseTableName: product_tags
            baseColumnNames: product_id
            constraintName: fk_product_tags_product
            referencedTableName: products
            referencedColumnNames: id
            onDelete: CASCADE
        - addForeignKeyConstraint:
            baseTableName: product_tags
            baseColumnNames: tag_id
            constraintName: fk_product_tags_tag
            referencedTableName: tags
            referencedColumnNames: id
            onDelete: CASCADE

  - changeSet:
      id: 006-create-product-variants
      author: system
      changes:
        - createTable:
            tableName: product_variants
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: sku
                  type: VARCHAR(50)
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: price
                  type: DECIMAL(10,2)
              - column:
                  name: product_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
        - addForeignKeyConstraint:
            baseTableName: product_variants
            baseColumnNames: product_id
            constraintName: fk_product_variants_product
            referencedTableName: products
            referencedColumnNames: id
            onDelete: CASCADE

  - changeSet:
      id: 007-create-variant-attributes
      author: system
      changes:
        - createTable:
            tableName: variant_attributes
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: false
              - column:
                  name: value
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: variant_id
                  type: UUID
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
        - addForeignKeyConstraint:
            baseTableName: variant_attributes
            baseColumnNames: variant_id
            constraintName: fk_variant_attributes_variant
            referencedTableName: product_variants
            referencedColumnNames: id
            onDelete: CASCADE

  - changeSet:
      id: 008-create-inventory
      author: system
      changes:
        - createTable:
            tableName: inventory
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: product_id
                  type: UUID
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: stock_quantity
                  type: INT
              - column:
                  name: low_stock_threshold
                  type: INT
              - column:
                  name: reserved_quantity
                  type: INT
                  defaultValueNumeric: 0
                  constraints:
                    nullable: false
              - column:
                  name: tracking_strategy
                  type: VARCHAR(50)
                  defaultValue: "FINITE"
                  constraints:
                    nullable: false
              - column:
                  name: version
                  type: BIGINT
                  defaultValueNumeric: 0
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
        - addForeignKeyConstraint:
            baseTableName: inventory
            baseColumnNames: product_id
            constraintName: fk_inventory_product
            referencedTableName: products
            referencedColumnNames: id
            onDelete: CASCADE

  - changeSet:
      id: 009-create-variant-inventory
      author: system
      changes:
        - createTable:
            tableName: variant_inventory
            columns:
              - column:
                  name: id
                  type: UUID
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: variant_id
                  type: UUID
                  constraints:
                    nullable: false
                    unique: true
              - column:
                  name: stock_quantity
                  type: INT
              - column:
                  name: low_stock_threshold
                  type: INT
              - column:
                  name: reserved_quantity
                  type: INT
                  defaultValueNumeric: 0
                  constraints:
                    nullable: false
              - column:
                  name: version
                  type: BIGINT
                  defaultValueNumeric: 0
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: updated_at
                  type: TIMESTAMP
        - addForeignKeyConstraint:
            baseTableName: variant_inventory
            baseColumnNames: variant_id
            constraintName: fk_variant_inventory_variant
            referencedTableName: product_variants
            referencedColumnNames: id
            onDelete: CASCADE